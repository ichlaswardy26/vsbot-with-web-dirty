<%- include('../partials/header') %>
<%- include('../partials/navbar') %>

<div class="flex">
  <%- include('../partials/sidebar') %>
  
  <main class="flex-1 p-8">
    <div class="max-w-7xl mx-auto">
      <!-- Page Header -->
      <div class="mb-8">
        <h1 class="text-3xl font-bold text-gray-800">Analytics</h1>
        <p class="text-gray-600 mt-2">Statistik dan analytics bot</p>
      </div>

      <!-- Stats Overview -->
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
        <div class="card-hover bg-white rounded-xl shadow-lg p-6 border border-gray-200">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-gray-500 text-sm font-medium">Total Users</p>
              <p class="text-3xl font-bold text-gray-800 mt-2"><%= stats.totalUsers.toLocaleString() %></p>
            </div>
            <div class="w-16 h-16 bg-purple-100 rounded-full flex items-center justify-center">
              <i class="fas fa-users text-purple-600 text-2xl"></i>
            </div>
          </div>
        </div>

        <div class="card-hover bg-white rounded-xl shadow-lg p-6 border border-gray-200">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-gray-500 text-sm font-medium">Total Souls</p>
              <p class="text-3xl font-bold text-gray-800 mt-2"><%= stats.totalSouls.toLocaleString() %></p>
            </div>
            <div class="w-16 h-16 bg-yellow-100 rounded-full flex items-center justify-center">
              <i class="fas fa-coins text-yellow-600 text-2xl"></i>
            </div>
          </div>
        </div>

        <div class="card-hover bg-white rounded-xl shadow-lg p-6 border border-gray-200">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-gray-500 text-sm font-medium">Average Level</p>
              <p class="text-3xl font-bold text-gray-800 mt-2"><%= stats.avgLevel %></p>
            </div>
            <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center">
              <i class="fas fa-chart-line text-blue-600 text-2xl"></i>
            </div>
          </div>
        </div>
      </div>

      <!-- Charts -->
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
        <!-- User Growth Chart -->
        <div class="bg-white rounded-xl shadow-lg p-6 border border-gray-200">
          <h2 class="text-xl font-bold text-gray-800 mb-4">User Growth</h2>
          <canvas id="userGrowthChart"></canvas>
        </div>

        <!-- Level Distribution Chart -->
        <div class="bg-white rounded-xl shadow-lg p-6 border border-gray-200">
          <h2 class="text-xl font-bold text-gray-800 mb-4">Level Distribution</h2>
          <canvas id="levelDistributionChart"></canvas>
        </div>
      </div>

      <!-- Economy Stats -->
      <div class="bg-white rounded-xl shadow-lg p-6 border border-gray-200 mb-8">
        <h2 class="text-xl font-bold text-gray-800 mb-4">Economy Statistics</h2>
        <canvas id="economyChart"></canvas>
      </div>

      <!-- Activity Heatmap -->
      <div class="bg-white rounded-xl shadow-lg p-6 border border-gray-200">
        <h2 class="text-xl font-bold text-gray-800 mb-4">Activity Overview</h2>
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
          <div class="bg-gradient-to-br from-purple-500 to-purple-600 rounded-lg p-6 text-white">
            <p class="text-sm opacity-90">Messages Today</p>
            <p class="text-3xl font-bold mt-2">-</p>
          </div>
          <div class="bg-gradient-to-br from-blue-500 to-blue-600 rounded-lg p-6 text-white">
            <p class="text-sm opacity-90">Commands Used</p>
            <p class="text-3xl font-bold mt-2">-</p>
          </div>
          <div class="bg-gradient-to-br from-green-500 to-green-600 rounded-lg p-6 text-white">
            <p class="text-sm opacity-90">Voice Minutes</p>
            <p class="text-3xl font-bold mt-2">-</p>
          </div>
          <div class="bg-gradient-to-br from-yellow-500 to-yellow-600 rounded-lg p-6 text-white">
            <p class="text-sm opacity-90">Active Users</p>
            <p class="text-3xl font-bold mt-2">-</p>
          </div>
        </div>
      </div>
    </div>
  </main>
</div>

<script>
  // User Growth Chart
  const userGrowthCtx = document.getElementById('userGrowthChart').getContext('2d');
  new Chart(userGrowthCtx, {
    type: 'line',
    data: {
      labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
      datasets: [{
        label: 'Users',
        data: [12, 19, 25, 32, 45, <%= stats.totalUsers %>],
        borderColor: 'rgb(102, 126, 234)',
        backgroundColor: 'rgba(102, 126, 234, 0.1)',
        tension: 0.4
      }]
    },
    options: {
      responsive: true,
      plugins: {
        legend: {
          display: false
        }
      },
      scales: {
        y: {
          beginAtZero: true
        }
      }
    }
  });

  // Level Distribution Chart
  const levelDistCtx = document.getElementById('levelDistributionChart').getContext('2d');
  new Chart(levelDistCtx, {
    type: 'doughnut',
    data: {
      labels: ['1-10', '11-20', '21-30', '31-40', '41+'],
      datasets: [{
        data: [30, 25, 20, 15, 10],
        backgroundColor: [
          'rgba(102, 126, 234, 0.8)',
          'rgba(59, 130, 246, 0.8)',
          'rgba(16, 185, 129, 0.8)',
          'rgba(245, 158, 11, 0.8)',
          'rgba(239, 68, 68, 0.8)'
        ]
      }]
    },
    options: {
      responsive: true,
      plugins: {
        legend: {
          position: 'bottom'
        }
      }
    }
  });

  // Economy Chart
  const economyCtx = document.getElementById('economyChart').getContext('2d');
  new Chart(economyCtx, {
    type: 'bar',
    data: {
      labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4'],
      datasets: [{
        label: 'Souls Earned',
        data: [1200, 1900, 3000, 5000],
        backgroundColor: 'rgba(245, 158, 11, 0.8)'
      }, {
        label: 'Souls Spent',
        data: [800, 1500, 2000, 3000],
        backgroundColor: 'rgba(239, 68, 68, 0.8)'
      }]
    },
    options: {
      responsive: true,
      scales: {
        y: {
          beginAtZero: true
        }
      }
    }
  });
</script>

<%- include('../partials/footer') %>
