<%- include('../partials/header') %>
<%- include('../partials/navbar') %>

<div class="flex">
  <%- include('../partials/sidebar') %>
  
  <main class="flex-1 p-8">
    <div class="max-w-7xl mx-auto">
      <!-- Page Header -->
      <div class="mb-8">
        <h1 class="text-3xl font-bold text-gray-800">Configuration</h1>
        <p class="text-gray-600 mt-2">Edit konfigurasi bot Anda</p>
      </div>

      <!-- Alert -->
      <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-6">
        <div class="flex">
          <div class="flex-shrink-0">
            <i class="fas fa-exclamation-triangle text-yellow-400"></i>
          </div>
          <div class="ml-3">
            <p class="text-sm text-yellow-700">
              <strong>Warning:</strong> Bot perlu di-restart setelah mengubah konfigurasi agar perubahan diterapkan.
            </p>
          </div>
        </div>
      </div>

      <!-- Configuration Form -->
      <form id="configForm" class="space-y-6">
        <!-- Bot Credentials -->
        <div class="bg-white rounded-xl shadow-lg p-6 border border-gray-200">
          <h2 class="text-xl font-bold text-gray-800 mb-4">
            <i class="fas fa-robot text-purple-600 mr-2"></i>Bot Credentials
          </h2>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label class="block text-gray-700 text-sm font-bold mb-2">Bot Token</label>
              <input type="password" name="TOKEN" value="<%= config.TOKEN || '' %>" 
                     class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
            </div>
            <div>
              <label class="block text-gray-700 text-sm font-bold mb-2">Client ID</label>
              <input type="text" name="CLIENT_ID" value="<%= config.CLIENT_ID || '' %>" 
                     class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
            </div>
            <div>
              <label class="block text-gray-700 text-sm font-bold mb-2">Guild ID</label>
              <input type="text" name="GUILD_ID" value="<%= config.GUILD_ID || '' %>" 
                     class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
            </div>
            <div>
              <label class="block text-gray-700 text-sm font-bold mb-2">Owner IDs (comma-separated)</label>
              <input type="text" name="OWNER_IDS" value="<%= config.OWNER_IDS || '' %>" 
                     class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
            </div>
          </div>
        </div>

        <!-- MongoDB -->
        <div class="bg-white rounded-xl shadow-lg p-6 border border-gray-200">
          <h2 class="text-xl font-bold text-gray-800 mb-4">
            <i class="fas fa-database text-green-600 mr-2"></i>MongoDB
          </h2>
          <div>
            <label class="block text-gray-700 text-sm font-bold mb-2">MongoDB URI</label>
            <input type="password" name="MONGO_URI" value="<%= config.MONGO_URI || '' %>" 
                   class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
          </div>
        </div>

        <!-- Channels -->
        <div class="bg-white rounded-xl shadow-lg p-6 border border-gray-200">
          <h2 class="text-xl font-bold text-gray-800 mb-4">
            <i class="fas fa-hashtag text-blue-600 mr-2"></i>Channels
          </h2>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label class="block text-gray-700 text-sm font-bold mb-2">Welcome Channel</label>
              <input type="text" name="WELCOME_CHANNEL_ID" value="<%= config.WELCOME_CHANNEL_ID || '' %>" 
                     class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
            </div>
            <div>
              <label class="block text-gray-700 text-sm font-bold mb-2">Boost Announce Channel</label>
              <input type="text" name="BOOST_ANNOUNCE_CHANNEL_ID" value="<%= config.BOOST_ANNOUNCE_CHANNEL_ID || '' %>" 
                     class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
            </div>
            <div>
              <label class="block text-gray-700 text-sm font-bold mb-2">Ticket Log Channel</label>
              <input type="text" name="TICKET_LOG_CHANNEL_ID" value="<%= config.TICKET_LOG_CHANNEL_ID || '' %>" 
                     class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
            </div>
            <div>
              <label class="block text-gray-700 text-sm font-bold mb-2">Donation Channel</label>
              <input type="text" name="DONATION_CHANNEL_ID" value="<%= config.DONATION_CHANNEL_ID || '' %>" 
                     class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
            </div>
          </div>
        </div>

        <!-- Features Settings -->
        <div class="bg-white rounded-xl shadow-lg p-6 border border-gray-200">
          <h2 class="text-xl font-bold text-gray-800 mb-4">
            <i class="fas fa-sliders-h text-orange-600 mr-2"></i>Features Settings
          </h2>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label class="block text-gray-700 text-sm font-bold mb-2">XP Min</label>
              <input type="number" name="XP_MIN" value="<%= config.XP_MIN || '15' %>" 
                     class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
            </div>
            <div>
              <label class="block text-gray-700 text-sm font-bold mb-2">XP Max</label>
              <input type="number" name="XP_MAX" value="<%= config.XP_MAX || '25' %>" 
                     class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
            </div>
            <div>
              <label class="block text-gray-700 text-sm font-bold mb-2">Voice XP Per Minute</label>
              <input type="number" name="VOICE_XP_PER_MINUTE" value="<%= config.VOICE_XP_PER_MINUTE || '10' %>" 
                     class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
            </div>
            <div>
              <label class="block text-gray-700 text-sm font-bold mb-2">Daily Reward</label>
              <input type="number" name="DAILY_REWARD" value="<%= config.DAILY_REWARD || '100' %>" 
                     class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
            </div>
          </div>
        </div>

        <!-- Save Button -->
        <div class="flex justify-end">
          <button type="submit" class="bg-purple-600 text-white px-8 py-3 rounded-lg font-semibold hover:bg-purple-700 transition">
            <i class="fas fa-save mr-2"></i>Save Configuration
          </button>
        </div>
      </form>
    </div>
  </main>
</div>

<script>
  document.getElementById('configForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const formData = new FormData(e.target);
    const config = {};
    
    for (let [key, value] of formData.entries()) {
      config[key] = value;
    }

    try {
      const response = await fetch('/api/config', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ config })
      });

      const result = await response.json();

      if (result.success) {
        alert(result.message);
      } else {
        alert('Failed to update configuration: ' + result.error);
      }
    } catch (error) {
      alert('Error: ' + error.message);
    }
  });
</script>

<%- include('../partials/footer') %>
